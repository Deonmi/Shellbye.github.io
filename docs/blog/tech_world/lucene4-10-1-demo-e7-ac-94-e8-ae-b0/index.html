

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      
        lucene(4.10.1) demo 笔记 -
      
      六系小白
    </title>
    
    <meta name="author" content="shellbye">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/hooligan/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/themes/hooligan/css-social-buttons/css/zocial.stripped.css">
    <link href="/assets/themes/hooligan/css/pygments.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/darkstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/hooligan/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link rel="shortcut icon" href="/assets/favicon.png">
    <link rel="apple-touch-icon" href="/assets/favicon.png">
    <!-- fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>

  <body>
    <div id="page-wrap">
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
            <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>

            <a class="brand" href="/">六系小白</a>

            <div class="nav-collapse">
              <ul class="nav">
                
                
                


  
    
      
      	
      	<li><a href="/archive/">历史记录</a></li>
      	
      
    
  
    
  
    
      
      	
      	<li><a href="/categories/">分类</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/blog/direct-era/">导演时代</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
      	
      	<li><a href="/blog/poet/">小白的诗</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/blog/small-games/">小游戏</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags/">标签</a></li>
      	
      
    
  
    
  
    
  



              </ul>
              <ul class="nav pull-right social visible-desktop">
                <li class="divider-vertical"></li>
                
                <li>
                  <a href="https://github.com/shellbye" class="zocial github icon" target="_blank">
                    <span class="hidden-desktop">Github</span>
                  </a>
                </li>
                
                
                
                
                
                
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="content">
          

<div class="page-header">
  <h1>
    lucene(4.10.1) demo 笔记 
    
  </h1>
</div>

<div class="row">
  <div class="span8">
    <p>今天按照师兄的安排，开始看lucene，首先看的就是官网的<a href="http://lucene.apache.org/core/4_10_1/demo/overview-summary.html">demo教程</a>，但是这里给出的是一个用命令行直接使用的jar包，没有源码，而且demo教程功能比较多，所以我找到了源码，并把它简化了一下，改成了用main函数直接可以运行的，记录如下。</p>

<p>1.IndexFiles.java</p>

<p>首先是索引的建立过程，我在简化官方给的<a href="http://lucene.apache.org/core/4_10_1/demo/src-html/org/apache/lucene/demo/IndexFiles.html">IndexFiles.java</a>文件时，多删除了第121行，导致IndexWriter没有关闭，所以在后面检索的时候就遇到了no segments* file found的错误，正确的最终简化版如下所示：</p>

<p>这里需要注意版本的问题，因为我使用的是最新版（4.10.1）所以里面的Version后面的数字与官网的是不同的，而且一些构造方法的传参也不一样了。</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">lucene</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.lucene.analysis.Analyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.analysis.standard.StandardAnalyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.document.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexWriterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.Term</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.store.Directory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.store.FSDirectory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.util.Version</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>

<span class="cm">/**
 * Created by shellbye on 10/23/14.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LuTestIndex</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">arg</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
        <span class="n">String</span> <span class="n">docsPath</span> <span class="o">=</span> <span class="s">"/home/shellbye/indexFile/"</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">indexPath</span> <span class="o">=</span> <span class="s">"/home/shellbye/result/"</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Indexing to directory '"</span> <span class="o">+</span> <span class="n">indexPath</span> <span class="o">+</span> <span class="s">"'..."</span><span class="o">);</span>

        <span class="n">Directory</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">indexPath</span><span class="o">));</span>
        <span class="kd">final</span> <span class="n">File</span> <span class="n">docDir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">docsPath</span><span class="o">);</span>
        <span class="n">Analyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardAnalyzer</span><span class="o">();</span>
        <span class="n">IndexWriterConfig</span> <span class="n">iwc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexWriterConfig</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_4_10_1</span><span class="o">,</span> <span class="n">analyzer</span><span class="o">);</span>

        <span class="c1">// Create a new index in the directory, removing any</span>
        <span class="c1">// previously indexed documents:</span>
        <span class="n">iwc</span><span class="o">.</span><span class="na">setOpenMode</span><span class="o">(</span><span class="n">IndexWriterConfig</span><span class="o">.</span><span class="na">OpenMode</span><span class="o">.</span><span class="na">CREATE</span><span class="o">);</span>

        <span class="n">IndexWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexWriter</span><span class="o">(</span><span class="n">dir</span><span class="o">,</span> <span class="n">iwc</span><span class="o">);</span>
        <span class="n">indexDocs</span><span class="o">(</span><span class="n">writer</span><span class="o">,</span> <span class="n">docDir</span><span class="o">);</span>
        <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Indexes the given file using the given writer, or if a directory is given,
     * recurses over files and directories found under the given directory.
     * &lt;p/&gt;
     * NOTE: This method indexes one document per input file.  This is slow.  For good
     * throughput, put multiple documents into your input file(s).  An example of this is
     * in the benchmark module, which can create "line doc" files, one document per line,
     * using the
     * &lt;a href="../../../../../contrib-benchmark/org/apache/lucene/benchmark/byTask/tasks/WriteLineDocTask.html"
     * &gt;WriteLineDocTask&lt;/a&gt;.
     *
     * @param writer Writer to the index where the given file/dir info will be stored
     * @param file   The file to index, or the directory to recurse into to find files to index
     * @throws java.io.IOException If there is a low-level I/O error
     */</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">indexDocs</span><span class="o">(</span><span class="n">IndexWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// do not try to index files that cannot be read</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">canRead</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">isDirectory</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">String</span><span class="o">[]</span> <span class="n">files</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
                <span class="c1">// an IO error could occur</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">files</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">files</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="n">indexDocs</span><span class="o">(</span><span class="n">writer</span><span class="o">,</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">files</span><span class="o">[</span><span class="n">i</span><span class="o">]));</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>

                <span class="n">FileInputStream</span> <span class="n">fis</span><span class="o">;</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">FileNotFoundException</span> <span class="n">fnfe</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// at least on windows, some temporary files raise this exception with an "access denied" message</span>
                    <span class="c1">// checking if the file can be read doesn't help</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span>

                <span class="k">try</span> <span class="o">{</span>

                    <span class="c1">// make a new, empty document</span>
                    <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>

                    <span class="c1">// Add the path of the file as a field named "path".  Use a</span>
                    <span class="c1">// field that is indexed (i.e. searchable), but don't tokenize</span>
                    <span class="c1">// the field into separate words and don't index term frequency</span>
                    <span class="c1">// or positional information:</span>
                    <span class="n">Field</span> <span class="n">pathField</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringField</span><span class="o">(</span><span class="s">"path"</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span> <span class="n">Field</span><span class="o">.</span><span class="na">Store</span><span class="o">.</span><span class="na">YES</span><span class="o">);</span>
                    <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">pathField</span><span class="o">);</span>

                    <span class="c1">// Add the last modified date of the file a field named "modified".</span>
                    <span class="c1">// Use a LongField that is indexed (i.e. efficiently filterable with</span>
                    <span class="c1">// NumericRangeFilter).  This indexes to milli-second resolution, which</span>
                    <span class="c1">// is often too fine.  You could instead create a number based on</span>
                    <span class="c1">// year/month/day/hour/minutes/seconds, down the resolution you require.</span>
                    <span class="c1">// For example the long value 2011021714 would mean</span>
                    <span class="c1">// February 17, 2011, 2-3 PM.</span>
                    <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">LongField</span><span class="o">(</span><span class="s">"modified"</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">lastModified</span><span class="o">(),</span> <span class="n">Field</span><span class="o">.</span><span class="na">Store</span><span class="o">.</span><span class="na">NO</span><span class="o">));</span>

                    <span class="c1">// Add the contents of the file to a field named "contents".  Specify a Reader,</span>
                    <span class="c1">// so that the text of the file is tokenized and indexed, but not stored.</span>
                    <span class="c1">// Note that FileReader expects the file to be in UTF-8 encoding.</span>
                    <span class="c1">// If that's not the case searching for special characters will fail.</span>
                    <span class="n">doc</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">TextField</span><span class="o">(</span><span class="s">"contents"</span><span class="o">,</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">fis</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">))));</span>

                    <span class="k">if</span> <span class="o">(</span><span class="n">writer</span><span class="o">.</span><span class="na">getConfig</span><span class="o">().</span><span class="na">getOpenMode</span><span class="o">()</span> <span class="o">==</span> <span class="n">IndexWriterConfig</span><span class="o">.</span><span class="na">OpenMode</span><span class="o">.</span><span class="na">CREATE</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// New index, so we just add the document (no old document can be there):</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"adding "</span> <span class="o">+</span> <span class="n">file</span><span class="o">);</span>
                        <span class="n">writer</span><span class="o">.</span><span class="na">addDocument</span><span class="o">(</span><span class="n">doc</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="c1">// Existing index (an old copy of this document may have been indexed) so</span>
                        <span class="c1">// we use updateDocument instead to replace the old one matching the exact</span>
                        <span class="c1">// path, if present:</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"updating "</span> <span class="o">+</span> <span class="n">file</span><span class="o">);</span>
                        <span class="n">writer</span><span class="o">.</span><span class="na">updateDocument</span><span class="o">(</span><span class="k">new</span> <span class="n">Term</span><span class="o">(</span><span class="s">"path"</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getPath</span><span class="o">()),</span> <span class="n">doc</span><span class="o">);</span>
                    <span class="o">}</span>

                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="mi">2</span><span class="o">.</span><span class="na">SearchFiles</span><span class="o">.</span><span class="na">java</span>

<span class="err">官方所给的版本功能比较全面，也比较复杂，所以我做了一点简化，最终结果如下：</span>


<span class="kn">package</span> <span class="n">lucene</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.lucene.analysis.Analyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.analysis.standard.StandardAnalyzer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.document.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.DirectoryReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.index.IndexReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.queryparser.classic.QueryParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.search.IndexSearcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.search.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.search.ScoreDoc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.search.TopDocs</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.lucene.store.FSDirectory</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**
 * Created by shellbye on 10/23/14.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LuTestSearch</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">arg</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
        <span class="c1">//使用LuTestIndex.java建立索引之后索引所在的目录（indexPath）</span>
        <span class="n">String</span> <span class="n">index</span> <span class="o">=</span> <span class="s">"/home/shellbye/result/"</span><span class="o">;</span>
        <span class="c1">//这里的field的值取决于LuTestIndex#100中doc.add时的值</span>
        <span class="n">String</span> <span class="n">field</span> <span class="o">=</span> <span class="s">"contents"</span><span class="o">;</span>

        <span class="n">IndexReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">DirectoryReader</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">index</span><span class="o">)));</span>
        <span class="n">IndexSearcher</span> <span class="n">searcher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexSearcher</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
        <span class="n">Analyzer</span> <span class="n">analyzer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardAnalyzer</span><span class="o">();</span>

        <span class="n">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>

        <span class="n">QueryParser</span> <span class="n">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryParser</span><span class="o">(</span><span class="n">field</span><span class="o">,</span> <span class="n">analyzer</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Enter query: "</span><span class="o">);</span>     <span class="c1">// prompt the user</span>
            <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">line</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">line</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Searching for: "</span> <span class="o">+</span> <span class="n">query</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">field</span><span class="o">));</span>
            <span class="c1">// 每页显示的数量</span>
            <span class="n">Integer</span> <span class="n">hitsPerPage</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
            <span class="n">doPagingSearch</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">searcher</span><span class="o">,</span> <span class="n">query</span><span class="o">,</span> <span class="n">hitsPerPage</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">reader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * This demonstrates a typical paging search scenario, where the search engine presents
     * pages of size n to the user. The user can then go to the next page if interested in
     * the next hits.
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doPagingSearch</span><span class="o">(</span><span class="n">BufferedReader</span> <span class="n">in</span><span class="o">,</span> <span class="n">IndexSearcher</span> <span class="n">searcher</span><span class="o">,</span> <span class="n">Query</span> <span class="n">query</span><span class="o">,</span>
                                      <span class="kt">int</span> <span class="n">hitsPerPage</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

        <span class="c1">// 至多搜索5页的结果</span>
        <span class="n">TopDocs</span> <span class="n">results</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">hitsPerPage</span><span class="o">);</span>
        <span class="n">ScoreDoc</span><span class="o">[]</span> <span class="n">hits</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">scoreDocs</span><span class="o">;</span>

        <span class="kt">int</span> <span class="n">numTotalHits</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="na">totalHits</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">numTotalHits</span> <span class="o">+</span> <span class="s">" total matching documents"</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">hits</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">hitsPerPage</span><span class="o">);</span>

            <span class="c1">// 遍历每一页</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">doc</span><span class="o">(</span><span class="n">hits</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">doc</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"path"</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">path</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">". "</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span>
                    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">title</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"   Title: "</span> <span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">));</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">". "</span> <span class="o">+</span> <span class="s">"No path for this document"</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"doc="</span> <span class="o">+</span> <span class="n">hits</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">doc</span> <span class="o">+</span> <span class="s">" score="</span> <span class="o">+</span> <span class="n">hits</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">score</span><span class="o">);</span>
            <span class="o">}</span>


            <span class="k">if</span> <span class="o">(</span><span class="n">end</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">break</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">numTotalHits</span> <span class="o">&gt;=</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
                <span class="kt">boolean</span> <span class="n">quit</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Press "</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">start</span> <span class="o">-</span> <span class="n">hitsPerPage</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"(p)revious page, "</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">hitsPerPage</span> <span class="o">&lt;</span> <span class="n">numTotalHits</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"(n)ext page, "</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"(q)uit or enter number to jump to a page."</span><span class="o">);</span>

                    <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">line</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="sc">'q'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">quit</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="sc">'p'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">hitsPerPage</span><span class="o">);</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">line</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">==</span> <span class="sc">'n'</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">hitsPerPage</span> <span class="o">&lt;</span> <span class="n">numTotalHits</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">start</span> <span class="o">+=</span> <span class="n">hitsPerPage</span><span class="o">;</span>
                        <span class="o">}</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="kt">int</span> <span class="n">page</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
                        <span class="k">if</span> <span class="o">((</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">hitsPerPage</span> <span class="o">&lt;</span> <span class="n">numTotalHits</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">start</span> <span class="o">=</span> <span class="o">(</span><span class="n">page</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">hitsPerPage</span><span class="o">;</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"No such page"</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">quit</span><span class="o">)</span> <span class="k">break</span><span class="o">;</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">numTotalHits</span><span class="o">,</span> <span class="n">start</span> <span class="o">+</span> <span class="n">hitsPerPage</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>参考文档：</p>

<p>0.<a href="http://stackoverflow.com/questions/3802021/no-segments-file-found">http://stackoverflow.com/questions/3802021/no-segments-file-found</a></p>

    <hr>
    <div class="pagination btn-group">
      
        <a class="btn prev" href="/blog/tech_world/log4j2-filter-e7-ac-94-e8-ae-b0/" title="log4j2 filter 笔记">&larr; Previous</a>
      
        <a class="btn" href="/archive">Archive</a>
      
        <a class="btn next" href="/blog/tech_world/pycharm-setup-virtualenv/" title="Pycharm setup virtualenv">Next &rarr;</a>
      
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'shellbye'; // required: replace example with your forum shortname
    var disqus_identifier = '1081 http://shellbye.github.com/?p=1081';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
  
  <div class="span4">
    <section>
      <h4>Published</h4>
      <div class="date"><span>23 October 2014</span></div>
           
    </section>
    
      <section>
        <h4>Category</h4>
        
        <span class="category">
          tech_world
        </span>
        
      </section>
         
    
      <section>
        <h4>Tags</h4>
        <ul class="tag_box">
          
          


  
     
    	<li><a href="/tags#lucene-ref">lucene <span>2</span></a></li>
    
  



        </ul>
      </section>
             
  </div>
</div>


        </div>
      </div> <!-- /container -->

      <div class="footer-push"></div>
    </div><!--/.page-wrap -->

    <footer>
      <div class="container">
        <p>&copy; 2018 shellbye
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://github.com/dhulihan/hooligan" target="_blank">The Hooligan Theme</a>
        </p>
      </div>
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/themes/hooligan/js/jquery.min.js"><\/script>')</script>
    <script src="/assets/themes/hooligan/bootstrap/js/bootstrap.min.js"></script>

    



  </body>
</html>

